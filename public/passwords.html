<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>إدارة كلمات المرور</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <style>
    body { background-color: #f4f6f9; padding: 20px; font-family: 'Segoe UI', sans-serif; }
    .password-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); margin-bottom: 15px; }
    table td, table th { vertical-align: middle; }
  </style>
</head>
<body>
  <div class="container">
    <h2 class="mb-4">🔑 إدارة كلمات المرور</h2>

    <div class="password-card">
      <form id="addPasswordForm" class="row g-3">
        <div class="col-md-5">
          <input type="text" class="form-control" id="section" placeholder="اسم القسم أو الجزء" required>
        </div>
        <div class="col-md-5">
          <div class="input-group">
            <input type="password" class="form-control" id="password" placeholder="كلمة المرور" required>
            <button type="button" class="btn btn-outline-secondary" id="togglePassword">👁</button>
          </div>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary w-100">➕ إضافة</button>
        </div>
      </form>
    </div>

    <table class="table table-bordered table-striped mt-4">
      <thead class="table-dark">
        <tr>
          <th>القسم</th>
          <th>كلمة المرور</th>
          <th>تاريخ الإضافة</th>
          <th>إجراءات</th>
        </tr>
      </thead>
      <tbody id="passwordsTable"></tbody>
    </table>
  </div>

<script>
const API_URL = '/api/passwords';

// عرض أو إخفاء كلمة المرور في النموذج
document.getElementById('togglePassword').addEventListener('click', () => {
  const pwField = document.getElementById('password');
  pwField.type = pwField.type === 'password' ? 'text' : 'password';
});

// تحميل جميع كلمات المرور
async function loadPasswords() {
  const res = await fetch(API_URL);
  const data = await res.json();
  const table = document.getElementById('passwordsTable');
  table.innerHTML = '';
  data.forEach(p => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.section}</td>
      <td>
        <input type="password" value="${p.password}" class="form-control form-control-sm pw-field" readonly>
        <button class="btn btn-sm btn-link toggle-pw">👁</button>
      </td>
      <td>${new Date(p.dateAdded).toLocaleString()}</td>
      <td>
        <button class="btn btn-warning btn-sm" onclick="editPassword('${p._id}', '${p.section}', '${p.password}')">✏️ تعديل</button>
        <button class="btn btn-danger btn-sm" onclick="deletePassword('${p._id}')">🗑️ حذف</button>
      </td>
    `;
    table.appendChild(tr);
  });

  document.querySelectorAll('.toggle-pw').forEach(btn => {
    btn.addEventListener('click', e => {
      const input = e.target.closest('td').querySelector('.pw-field');
      input.type = input.type === 'password' ? 'text' : 'password';
    });
  });
}

// إضافة كلمة مرور
document.getElementById('addPasswordForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const section = document.getElementById('section').value;
  const password = document.getElementById('password').value;
  await fetch(API_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ section, password })
  });
  e.target.reset();
  loadPasswords();
});

// تعديل كلمة مرور
async function editPassword(id, section, password) {
  const newSection = prompt('اسم القسم:', section);
  if (!newSection) return;
  const newPassword = prompt('كلمة المرور:', password);
  if (!newPassword) return;
  await fetch(`${API_URL}/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ section: newSection, password: newPassword })
  });
  loadPasswords();
}

// حذف كلمة مرور
async function deletePassword(id) {
  if (!confirm('هل أنت متأكد من الحذف؟')) return;
  await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
  loadPasswords();
}

loadPasswords();
</script>
</body>
</html>
