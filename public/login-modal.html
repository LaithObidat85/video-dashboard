<!-- نافذة تسجيل الدخول -->
<div class="modal fade" id="passwordModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <!-- رأس المودال -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">🔒 صفحة محمية - تسجيل الدخول</h5>
        <!-- ❌ تمت إزالة زر الإغلاق -->
      </div>

      <!-- جسم المودال -->
      <div class="modal-body text-center">
        <!-- أيقونة قفل كبيرة -->
        <div class="mb-3">
          <i class="bi bi-shield-lock-fill" style="font-size:3rem; color:#0d6efd;"></i>
        </div>
        <!-- رسالة توضيحية -->
        <p class="fw-bold text-muted mb-3">
          هذه الصفحة محمية، الرجاء إدخال كلمة المرور للمتابعة
        </p>
        <!-- حقل كلمة المرور -->
        <input type="password" id="dashboardPassword" class="form-control" placeholder="أدخل كلمة المرور" lang="en" autofocus>
      </div>

      <!-- أزرار المودال -->
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" id="cancelBtn">إلغاء</button>
        <button type="button" class="btn btn-primary" id="confirmDashboardAccess">دخول</button>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const passwordModal = new bootstrap.Modal(document.getElementById("passwordModal"), {
    backdrop: 'static',
    keyboard: false
  });
  passwordModal.show();

  const passwordInput = document.getElementById("dashboardPassword");
  const confirmBtn = document.getElementById("confirmDashboardAccess");
  const cancelBtn = document.getElementById("cancelBtn");

  // ✅ تركيز المؤشر تلقائياً
  passwordInput.focus();

  // ✅ وظيفة التحقق
  async function verifyPassword() {
    const password = passwordInput.value;
    const res = await fetch("/api/verify-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ password })
    });

    if (res.status === 200) {
      passwordModal.hide();
    } else {
      alert("❌ كلمة المرور غير صحيحة");
      passwordInput.value = "";
      passwordInput.focus();
    }
  }

  // عند الضغط على زر دخول
  confirmBtn.addEventListener("click", verifyPassword);

  // ✅ عند الضغط على Enter
  passwordInput.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      verifyPassword();
    }
  });

  // ✅ عند الضغط على زر إلغاء → العودة للرئيسية
  cancelBtn.addEventListener("click", function () {
    window.location.href = "index.html";
  });
});
</script>
