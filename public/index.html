<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>الرئيسية</title>
  <link rel="icon" type="image/png" href="https://www.dropbox.com/scl/fi/f283e4rvv5cf9x12a1cic/my-website-logo.png?rlkey=yia776im7klypy27af32m0scy&e=1&st=vhaprvzh&dl=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    body {
      background: linear-gradient(to right, #e0eafc, #cfdef3);
      padding: 20px;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .header-controls {display:flex;justify-content:center;align-items:center;position:relative;gap:10px;}
    .header-controls h3 {flex:1;text-align:center;margin:0;}
    .video-card {background:white;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);padding:12px;margin:5px;width:300px;display:flex;flex-direction:column;justify-content:flex-start;transition:transform 0.2s ease, box-shadow 0.2s ease;}
    .video-card:hover {transform:scale(1.02);box-shadow:0 4px 12px rgba(0,0,0,0.15);}
    .video-title {font-weight:bold;margin-bottom:6px;min-height:48px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;}
    .video-description {color:#0d6efd;cursor:pointer;min-height:40px;overflow:hidden;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;margin-bottom:8px;}
    .video-grid {display:flex;flex-wrap:wrap;justify-content:center;gap:15px;}
    video,iframe {width:100%;height:200px;border-radius:6px;}
    .sharepoint-frame {width:100%;height:200px;border-radius:6px;display:block;object-fit:cover;}
    .popout-button {background-color:#0d6efd;color:white;border:none;padding:6px 12px;border-radius:5px;cursor:pointer;margin-top:6px;}
    footer {text-align:center;margin-top:10px;font-weight:bold;color:#333;font-size:1.1rem;animation:glow 1.5s infinite alternate;}
    @keyframes glow {from{color:#333;text-shadow:none;}to{color:#0d6efd;text-shadow:0 0 10px #0d6efd;}}
    .bottom-buttons {display:flex;justify-content:center;gap:10px;margin-bottom:10px;}
    .navbar-nav .nav-link {transition:color 0.3s ease, background 0.3s ease;padding:8px 12px;border-radius:5px;}
    .navbar-nav .nav-link:hover {background:rgba(255,255,255,0.15);}
    .navbar-nav .nav-link::after {content:'';position:absolute;width:0;height:2px;left:0;bottom:0;background:white;transition:width 0.3s ease;}
    .navbar-nav .nav-link:hover::after,.navbar-nav .nav-link.active::after {width:100%;}
    .scrolled {box-shadow:0 4px 10px rgba(0,0,0,0.2)!important;}
    body.dark-mode {background:#121212!important;color:#eaeaea!important;}
    body.dark-mode nav {background:linear-gradient(to right,#222,#000)!important;}
    .toast-container {position:fixed;top:20px;left:50%;transform:translateX(-50%);z-index:9999;}
  </style>
</head>
<body>

<nav id="mainNavbar" class="navbar navbar-expand-lg sticky-top shadow-sm" 
     style="background: linear-gradient(to right, #0d6efd, #0b5ed7); transition: box-shadow 0.3s ease;">
  <div class="container-fluid">
    <div class="collapse navbar-collapse" id="navbarContent">
      <ul class="navbar-nav mb-2 mb-lg-0">
        <li class="nav-item">
          <a class="nav-link text-white fw-semibold position-relative" href="#" onclick="requestDashboardAccess()">
            <i class="bi bi-shield-lock-fill fs-5"></i> لوحة التحكم
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link text-white fw-semibold position-relative" href="https://video-dashboard-backend.onrender.com/viewlinks.html">
            <i class="bi bi-link-45deg fs-5"></i> روابط مهمة
          </a>
        </li>
        <li class="nav-item" id="logoutNavItem" style="display:none;">
          <a class="nav-link text-white fw-semibold position-relative" href="#" onclick="logout()">
            <i class="bi bi-box-arrow-right fs-5"></i> تسجيل الخروج
          </a>
        </li>
      </ul>
    </div>
    <a class="navbar-brand text-white fw-bold ms-auto d-flex align-items-center" href="#">
      <i class="bi bi-collection-play-fill fs-4 me-1"></i> Video Dashboard
    </a>
    <button class="navbar-toggler text-white border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
      <span class="navbar-toggler-icon"></span>
    </button>
    <button id="themeToggle" class="btn btn-sm btn-outline-light ms-2">
      <i class="bi bi-moon-stars-fill"></i>
    </button>
  </div>
</nav>

<div class="container text-center">
  <h3>اختر القسم لعرض الفيديوهات</h3>
  <select id="departmentSelect" class="form-select mb-3">
    <option value="">-- اختر القسم --</option>
  </select>
  <input id="searchInput" class="form-control mb-4" type="text" placeholder="ابحث بعنوان أو وصف الفيديو..." disabled>
  <div id="videoContainer" class="video-grid"></div>
</div>

<footer>برمجة وتطوير: ليث عبيدات</footer>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- نافذة عرض الوصف -->
<div class="modal fade" id="descModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="descTitle"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body" id="descContent" style="white-space: pre-wrap; text-align: justify;"></div>
    </div>
  </div>
</div>

<!-- نافذة كلمة المرور -->
<div class="modal fade" id="passwordModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">🔐 الدخول إلى لوحة التحكم</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <input type="password" id="dashboardPassword" class="form-control" placeholder="أدخل كلمة المرور" lang="en">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
        <button type="button" class="btn btn-primary" id="confirmDashboardAccess">دخول</button>
      </div>
    </div>
  </div>
</div>

<script>
const API_BASE = 'https://video-dashboard-backend.onrender.com';

// دالة عرض Toast
function showToast(message, type="success") {
  const toast = document.createElement('div');
  toast.className = `toast align-items-center text-bg-${type} border-0 mb-2`;
  toast.setAttribute('role', 'alert');
  toast.innerHTML = `
    <div class="d-flex">
      <div class="toast-body">${message}</div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>`;
  document.getElementById('toastContainer').appendChild(toast);
  new bootstrap.Toast(toast, { delay: 2500 }).show();
}

// تسجيل الخروج باستخدام Toast
async function logout() {
  try {
    await fetch(`${API_BASE}/api/logout`, { method: "POST" });
    sessionStorage.clear(); 
    document.getElementById("logoutNavItem").style.display = "none";
    showToast("✅ تم تسجيل الخروج بنجاح");
  } catch (err) { 
    showToast("❌ حدث خطأ أثناء تسجيل الخروج", "danger");
  }
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
